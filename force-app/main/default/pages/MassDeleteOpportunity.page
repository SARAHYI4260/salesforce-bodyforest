<apex:page standardController="Opportunity" 
           recordSetVar="opportunities" 
           extensions="MassDeleteExtension">
    <script type="text/javascript">
        // 1. ì„ íƒëœ ID ê°€ì ¸ì˜¤ê¸°
        var selectedIds = '{!selectedIds}';
        
        // 2. ID ìœ íš¨ì„± ì²´í¬
        if (!selectedIds || selectedIds.trim() === '') {
            alert('ì‚­ì œí•  ë ˆì½”ë“œë¥¼ ìµœì†Œ í•˜ë‚˜ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.'); // ğŸ‡°ğŸ‡· í•œêµ­ì–´ ìˆ˜ì •
            window.history.back();
        } else {
            // 3. Flow URL ì„¤ì • (API Name í™•ì¸ í•„ìˆ˜: Mass_Delete_Flow)
            var flowUrl = '/flow/Mass_Delete_Flow';
            
            // 4. íŒŒë¼ë¯¸í„° êµ¬ì„±
            var params = '?recordIdString=' + encodeURIComponent(selectedIds);
            
            // ğŸ”¥ [í•µì‹¬ ìˆ˜ì •] ë¬´í•œ ë£¨í”„ ë°©ì§€ ë¡œì§
            // í˜„ì¬ VF í˜ì´ì§€(window.location.href)ê°€ ì•„ë‹ˆë¼, 
            // Salesforceê°€ ì²˜ìŒì— ë„˜ê²¨ì¤€ ë¦¬ìŠ¤íŠ¸ ë·° ì£¼ì†Œ(retURL)ë¥¼ ì°¾ì•„ì„œ ì‚¬ìš©í•©ë‹ˆë‹¤.
            var urlParams = new URLSearchParams(window.location.search);
            var originalRetUrl = urlParams.get('retURL');
            
            // ë§Œì•½ retURLì´ ì—†ë‹¤ë©´ Opportunity ê¸°ë³¸ ë¦¬ìŠ¤íŠ¸ í™ˆìœ¼ë¡œ ì´ë™
            if (!originalRetUrl) {
                originalRetUrl = '/lightning/o/Opportunity/list';
            }
            
            params += '&retURL=' + encodeURIComponent(originalRetUrl);
            
            // 5. ì´ë™
            window.location.href = flowUrl + params;
        }
    </script>
</apex:page>